<meta charset="utf8" />
<html>

<style>
    table,
    th,
    td {
        border: 1px solid black;
        inline-size: -webkit-fill-available;
    }
    
    input[type="text"],
    input[type="button"] {
        width: 100%;
    }
</style>

<body>
    <div id="root">
        <p id="loading">Loading...</p>
    </div>
</body>

<script src='https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.4.0/dist/sql-wasm.js'></script>
<script>
    var db = undefined;
    let config = {
        locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.4.0/dist/${filename}`
    }

    fileUpload = () => {
        let inputFileUpload = document.getElementById("dbFile");
        var dbFile = inputFileUpload.files[0];
        var fr = new FileReader();
        fr.onload = function() {
            var Uints = new Uint8Array(fr.result);
            initSqlJs(config).then(function(SQL) {
                db = new SQL.Database(Uints);
                let inputFileUpload = document.getElementById("dbFile");
                inputFileUpload.parentElement.removeChild(inputFileUpload);

                printLinks();
            });
        }
        fr.readAsArrayBuffer(dbFile);
    }

    printLinks = () => {
        let tableExists = document.getElementById("myTable");
        if (tableExists) {
            tableExists.parentElement.removeChild(tableExists);
        }

        var stmt = db.prepare("select id, link from masterLinks where status = 'A'");
        let table = document.createElement("TABLE");
        table.setAttribute("id", "myTable");

        while (stmt.step()) {
            var row = stmt.getAsObject();
            // console.log('Here is a row: ' + JSON.stringify(row));
            let TR = document.createElement("TR");
            let TD = document.createElement("TD");
            let text = document.createTextNode(row.link);
            TD.appendChild(text);

            let button = document.createElement("INPUT");
            button.setAttribute("type", "button");
            button.setAttribute("onclick", "disableLink(" + row.id + ")");
            button.setAttribute("value", "Disable");

            let TD1 = document.createElement("TD");
            TD1.appendChild(button);

            TR.appendChild(TD);
            TR.appendChild(TD1);

            table.appendChild(TR);
        }

        let TR = document.createElement("TR");
        let TD = document.createElement("TD");

        let text = document.createElement("INPUT");
        text.setAttribute("type", "text");
        text.setAttribute("id", "addLink");

        TD.appendChild(text);
        TR.appendChild(TD);

        let button = document.createElement("INPUT");
        button.setAttribute("type", "button");
        button.setAttribute("onclick", "addLink()");
        button.setAttribute("value", "AddLink");

        let TD1 = document.createElement("TD");
        TD1.appendChild(button);

        TR.appendChild(TD1);

        table.appendChild(TR);

        document.getElementById("root").appendChild(table);
    };

    disableLink = (id) => {
        if (!db) {
            alert("DB not set.");
            return;
        }

        console.log(id);

        db.run(`update masterLinks set status = 'I' where id = ${id}`);
        printLinks();
    };

    addLink = () => {
        if (!db) {
            alert("DB not set.");
            return;
        }

        let link = document.getElementById("addLink").value;
        console.log(`addLink:${link}`);
        db.run(`insert into masterLinks (link, status) values ('${link}', 'A')`);
        printLinks();
    };
</script>

<script>
    let loading = document.getElementById("loading");
    loading.parentElement.removeChild(loading);

    let fileInput = document.createElement("INPUT");
    fileInput.setAttribute("type", "file");
    fileInput.setAttribute("id", "dbFile");
    fileInput.setAttribute("onchange", "fileUpload()");
    document.getElementById("root").appendChild(fileInput);
</script>

</html>

</html>